#!/usr/bin/env node

var fs=require("fs");
var path=require("path");
var D=path.sep;
var os=require("os");
var isWindows= os.platform().indexOf("win")==0;

var nodePath=process.argv[0];
var exeFilePath=process.argv[1];
var otherArguments=process.argv.slice(2);
try{
	var linkFilePath=fs.readlinkSync(exeFilePath);
	if(path.isAbsolute(linkFilePath)){
		exeFilePath=linkFilePath;
	}else{
		exeFilePath=path.normalize(path.dirname(exeFilePath)+D+linkFilePath);
	}
}catch(e){}

if(!path.isAbsolute(exeFilePath)){
	exeFilePath=path.normalize((process.cwd()+exeFilePath));
}

var currentAppPath=path.normalize(path.dirname(exeFilePath));
var currentNodePath=path.dirname(nodePath);

var dependencies_node_modules_D=currentAppPath+D+"node_modules"+D;
var binSWPath;
var Start;
//var swjsfile=dependencies_node_modules_D+"weblet"+D+"node_modules"+D+"swordfish"+D+"swordfish.js";
var swjsfile=dependencies_node_modules_D+"swordfish"+D+"swordfish.js";

try{
	Start=require(dependencies_node_modules_D+"swordfish");
	binSWPath=swjsfile;//dependencies_node_modules_D+"weblet"+D+"node_modules"+D+"swordfish"+D+"swordfish.js";
}catch(e){
	Start=require("swordfish");
	binSWPath=null;
}
var webletPath=dependencies_node_modules_D+"weblet";

var htdocs=currentAppPath+D+"htdocs";
var PORT="1234";

var swpPath=isWindows?("swp="+"node"+" "+swjsfile):("swp="+binSWPath);
var jspPath="jsp="+"node";

////"-a","127.0.0.1",

var arguments=[(webletPath+D+"weblet.sw")].concat(["-p",PORT
	,"-e",currentNodePath
	,"-x",swpPath
	,"-x",jspPath

	,"-o"
	,htdocs]).concat(otherArguments);

Start(binSWPath,arguments);
