var system=require("system");
var args=system.args;

var toURL=args[1];
var injectedScriptURL=args[2];
var proUrl=args[3];
var ldImgs=(args[4]=="true");
var font=args[5]||"serif";

var page=require("webpage").create();

var OUT_TIME=180000;
page.settings.userAgent="Mozilla/5.0 (iPhone; CPU iPhone OS 5_0_1 like Mac OS X) AppleWebKit/534.46 (KHTML, like Gecko) Mobile/9A405";
page.open(toURL,function(status){
	page.includeJs(injectedScriptURL,function(){
		var mydoc=page.evaluate(function(font,proUrl,ldImgs){
			var convertSetting={
				"title":{
					"maxCharacters":20,
					"style":{
						"font-family":("serif"==font?"sans-serif":font),
						"font-size":14,
					}
				},
				"text":{
					"style":{
						"font-family":"serif",
						"font-size":12
					}
				}
				,"bodyStyle":{
					"font-family":font,
					"font-size":10,
				}
			};
			var DOM2Obj=pi.word.convert.dom2obj;
			var mydoc=DOM2Obj.$(document,convertSetting,proUrl,ldImgs);
			delete mydoc.isCJK;
			return JSON.stringify(mydoc);
		},font,proUrl,ldImgs);
		console.log(mydoc);
		phantom.exit();
	});
});
setTimeout(function(){
	phantom.exit();
},OUT_TIME);
